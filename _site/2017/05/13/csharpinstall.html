
<!DOCTYPE>
<html lang="zh-cn" data-scribe-reduced-action-queue="true">
  <head>
    <meta content='c#写一个自动安装包带7z自动解压释放安装 - LiberXue|FullStack|独立开发者|jekyll blog|GitHub blog' name='title' />
    <meta content='c#写一个自动安装包带7z自动解压释放安装 - LiberXue|FullStack|独立开发者|jekyll blog|GitHub blog' name='og:title' />
    <title>c#写一个自动安装包带7z自动解压释放安装 - LiberXue|FullStack|独立开发者|jekyll blog|GitHub blog</title>
    <!--                                                                                                                                                    
                               bbbbbbbb                                                                                                            
LLLLLLLLLLL               iiii b::::::b                                                 XXXXXXX       XXXXXXX                                      
L:::::::::L              i::::ib::::::b                                                 X:::::X       X:::::X                                      
L:::::::::L               iiii b::::::b                                                 X:::::X       X:::::X                                      
LL:::::::LL                     b:::::b                                                 X::::::X     X::::::X                                      
  L:::::L               iiiiiii b:::::bbbbbbbbb        eeeeeeeeeeee    rrrrr   rrrrrrrrrXXX:::::X   X:::::XXXuuuuuu    uuuuuu      eeeeeeeeeeee    
  L:::::L               i:::::i b::::::::::::::bb    ee::::::::::::ee  r::::rrr:::::::::r  X:::::X X:::::X   u::::u    u::::u    ee::::::::::::ee  
  L:::::L                i::::i b::::::::::::::::b  e::::::eeeee:::::eer:::::::::::::::::r  X:::::X:::::X    u::::u    u::::u   e::::::eeeee:::::ee
  L:::::L                i::::i b:::::bbbbb:::::::be::::::e     e:::::err::::::rrrrr::::::r  X:::::::::X     u::::u    u::::u  e::::::e     e:::::e
  L:::::L                i::::i b:::::b    b::::::be:::::::eeeee::::::e r:::::r     r:::::r  X:::::::::X     u::::u    u::::u  e:::::::eeeee::::::e
  L:::::L                i::::i b:::::b     b:::::be:::::::::::::::::e  r:::::r     rrrrrrr X:::::X:::::X    u::::u    u::::u  e:::::::::::::::::e 
  L:::::L                i::::i b:::::b     b:::::be::::::eeeeeeeeeee   r:::::r            X:::::X X:::::X   u::::u    u::::u  e::::::eeeeeeeeeee  
  L:::::L         LLLLLL i::::i b:::::b     b:::::be:::::::e            r:::::r         XXX:::::X   X:::::XXXu:::::uuuu:::::u  e:::::::e           
LL:::::::LLLLLLLLL:::::Li::::::ib:::::bbbbbb::::::be::::::::e           r:::::r         X::::::X     X::::::Xu:::::::::::::::uue::::::::e          
L::::::::::::::::::::::Li::::::ib::::::::::::::::b  e::::::::eeeeeeee   r:::::r         X:::::X       X:::::X u:::::::::::::::u e::::::::eeeeeeee  
L::::::::::::::::::::::Li::::::ib:::::::::::::::b    ee:::::::::::::e   r:::::r         X:::::X       X:::::X  uu::::::::uu:::u  ee:::::::::::::e  
LLLLLLLLLLLLLLLLLLLLLLLLiiiiiiiibbbbbbbbbbbbbbbb       eeeeeeeeeeeeee   rrrrrrr         XXXXXXX       XXXXXXX    uuuuuuuu  uuuu    eeeeeeeeeeeeee                                                                                                                                                                                                                                                                                                   
!-->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>c#写一个自动安装包带7z自动解压释放安装 - LiberXue|FullStack|独立开发者|jekyll blog|GitHub blog</title>
  <meta name="description"  content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="author"  content="设置安装包参数和信息        public string strCompanyNameEnglish = "liberxue";        public string strProductNameEnglish = "lib..." property='og:description' />
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="c#写一个自动安装包带7z自动解压释放安装 - LiberXue|FullStack|独立开发者|jekyll blog|GitHub blog">
  <meta name="twitter:description"  content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="twitter:keywords"  content="设置安装包参数和信息        public string strCompanyNameEnglish = "liberxue";        public string strProductNameEnglish = "lib..." property='og:description' />
  <meta property="og:type" content="article">
  <meta property="og:title" content="c#写一个自动安装包带7z自动解压释放安装 - LiberXue|FullStack|独立开发者|jekyll blog|GitHub blog">
  <meta property="og:description" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="og:keywords"  content="设置安装包参数和信息        public string strCompanyNameEnglish = "liberxue";        public string strProductNameEnglish = "lib..." property='og:description' />
  <meta name="theme-Jekyll by liberxue" content="#eb5055"> 
  <link rel="icon" type="image/png" href="http://localhost:4000/stylesheets/favicons/favicon.ico" />
  <link href="http://localhost:4000/stylesheets/favicons/favicon.ico" rel="shortcut icon" type="image/png">
  <link rel="canonical" href="http://localhost:4000/">
  <link rel="alternate" type="application/rss+xml" title="Liberxue" href="http://localhost:4000/feed.xml">
  <meta charset="UTF-8">  
  <link rel="manifest" href="/manifest.json">
  <link rel="shortcut icon" href="http://localhost:4000/stylesheets/favicons/favicon.ico" type="image/x-icon">
  <meta name="keywords"  content="设置安装包参数和信息        public string strCompanyNameEnglish = "liberxue";        public string strProductNameEnglish = "lib..." property='og:description' />
  <meta name="description" content="nothing is more practicla than a good theory" />
  <link href="https://cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
  <link href="http://localhost:4000/stylesheets/style-vlpismine.css" rel="stylesheet">

  <meta content='http://localhost:4000/2017/05/13/csharpinstall.html' property='og:url' />
  <meta content="设置安装包参数和信息        public string strCompanyNameEnglish = "liberxue";        public string strProductNameEnglish = "lib..." property='og:description' />
  <meta content="article" property="og:type" />


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-101222464-1', 'auto');
  ga('send', 'pageview');
</script>


  </head>
<body class="" gtools_scp_screen_capture_injected="true">
<header id="header" class="header bg-white">
    <div class="navbar-container">
      <a href="/?liberxue" title="访问 LiberXue|FullStack|独立开发者|jekyll blog|GitHub blog" class="navbar-logo"> <img src="http://localhost:4000/stylesheets/images/logo-liberxue.png" alt="LiberXue|FullStack|独立开发者|jekyll blog|GitHub blog"> </a>
        <div class="navbar-menu">
                         
            <a href="http://localhost:4000/">首页</a>
                             
            <a href="http://localhost:4000/book">书籍</a>
                             
            <a href="http://localhost:4000/road">旅游</a>
                             
            <a href="http://localhost:4000/archives">归档</a>
                             
            <a href="http://localhost:4000/tags">标签</a>
                             
            <a href="http://localhost:4000/about">关于</a>
                
          </div>
        <div class="navbar-search" onclick="">
            <span class="icon-search"></span>
            <form id="cb-search-btn" role="search">
         <span class="search-box">
         <input type="text" class="input" id="cb-search-content" required="true" placeholder="标题 标签..." maxlength="30" autocomplete="off">
        </span>
            </form>
        </div>
        <div class="navbar-mobile-menu" onclick="">
            <span class="icon-menu cross"><span class="middle"></span></span>
            <ul>
                          
                <li><a href="http://localhost:4000/">首页</a></li>
                            
                <li><a href="http://localhost:4000/book">书籍</a></li>
                            
                <li><a href="http://localhost:4000/road">旅游</a></li>
                            
                <li><a href="http://localhost:4000/archives">归档</a></li>
                            
                <li><a href="http://localhost:4000/tags">标签</a></li>
                            
                <li><a href="http://localhost:4000/about">关于</a></li>
                 
            </ul>
        </div>
    </div>
</header>
<div class="post-header-thumb bg-white}">
	<div class="post-header-thumb-op"></div>
	<div class="post-header-thumb">
		<div class="post-header-thumb-container">
    <h1 class="post-title" itemprop="name headline">
	c#写一个自动安装包带7z自动解压释放安装</h1>
		 <div class="post-data">  
	 <time datetime="2017-05-13 00:00:00" itemprop="datePublished">发布时间：2017-05-13 00:00:00</time>
     <a href="/tags#csharp" title="访问 csharp" data-hover="博客分类: csharp">博客分类: csharp</a>
    <a href="#read"> 阅读次数: comments</a> 
			</div>
            <div class="post-tags">
                
      
      
       
          <a href="/tags#c#" title="访问c#" data-hover="c#">
          c# <span>(5)</span>
          
</a>
       
          <a href="/tags#打包安装" title="访问打包安装" data-hover="打包安装">
          打包安装 <span>(1)</span>
          
</a>
       
          <a href="/tags#debug打包" title="访问debug打包" data-hover="debug打包">
          debug打包 <span>(1)</span>
          
</a>
       
          <a href="/tags#winfrom" title="访问winfrom" data-hover="winfrom">
          winfrom <span>(3)</span>
          
</a>
       
          <a href="/tags#c++" title="访问c++" data-hover="c++">
          c++ <span>(1)</span>
          
</a>
       
          <a href="/tags#zip" title="访问zip" data-hover="zip">
          zip <span>(1)</span>
          
</a>
       
          <a href="/tags#7z" title="访问7z" data-hover="7z">
          7z <span>(1)</span>
          
</a>
       
          <a href="/tags#自释放" title="访问自释放" data-hover="自释放">
          自释放 <span>(1)</span>
          
</a>
       
          <a href="/tags#自定义安装包" title="访问自定义安装包" data-hover="自定义安装包">
          自定义安装包 <span>(1)</span>
          
</a>
      
      
      
     
	</div>
</div>
</div></div>
<article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
	<div class="post-header">
		<h1 class="post-title" itemprop="name headline">
			c#写一个自动安装包带7z自动解压释放安装</h1>
		<div class="post-data">
				<time datetime="2017-05-13 00:00:00" itemprop="datePublished">2017-05-13 00:00:00</time>
		</div>
	</div>
	<div id="post-content" class="post-content" itemprop="articleBody">
         <p class="post-tags">
    
      
      
       
          <a href="/tags#c#" title="访问c#" data-hover="c#">
          c# <span>(5)</span>
          </a>
       
          <a href="/tags#打包安装" title="访问打包安装" data-hover="打包安装">
          打包安装 <span>(1)</span>
          </a>
       
          <a href="/tags#debug打包" title="访问debug打包" data-hover="debug打包">
          debug打包 <span>(1)</span>
          </a>
       
          <a href="/tags#winfrom" title="访问winfrom" data-hover="winfrom">
          winfrom <span>(3)</span>
          </a>
       
          <a href="/tags#c++" title="访问c++" data-hover="c++">
          c++ <span>(1)</span>
          </a>
       
          <a href="/tags#zip" title="访问zip" data-hover="zip">
          zip <span>(1)</span>
          </a>
       
          <a href="/tags#7z" title="访问7z" data-hover="7z">
          7z <span>(1)</span>
          </a>
       
          <a href="/tags#自释放" title="访问自释放" data-hover="自释放">
          自释放 <span>(1)</span>
          </a>
       
          <a href="/tags#自定义安装包" title="访问自定义安装包" data-hover="自定义安装包">
          自定义安装包 <span>(1)</span>
          </a>
      
      
      
     
</p>
<h3 id="设置安装包参数和信息">设置安装包参数和信息</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>        public string strCompanyNameEnglish = "liberxue";
        public string strProductNameEnglish = "liberxue";
        public string strServiceNameEnglish = "liberxue";
        public string strCompanyURL = "http://www.liberxue.com";
        private System.Collections.Specialized.StringCollection folderCol;
        private static ZipClass zipClass = new ZipClass();  //压缩工具类
        private static UnZipClass unZipC = new UnZipClass();  //解压缩类
</code></pre>
</div>
<ul>
  <li>注释下：解压和压缩类都是采用我的我GitHub公开的无dll类 毕竟谁也下载一个软件带一个dll解压类看起来多难受。。。怪怪得哈。
先上个图：
<img src="http://ospsx22m9.bkt.clouddn.com/install.gif" alt="install" />
    <h3 id="解压释放">解压释放</h3>
    <div class="highlighter-rouge"><pre class="highlight"><code> lblDoing.Text = "正在释放运行组建 . . .";
              lblLoadingDoing.Size = new Size(lblLoadingDoing.Size.Width + 35, lblLoadingDoing.Size.Height);
              Application.DoEvents();
              File.WriteAllBytes(strInstallationPath + "\\Debug.zip", Properties.Resources.Debug);

              string zipFile = txtPath.Text+ "\\Debug.zip";
              string unZipFileTo = txtPath.Text;   //解压到哪个目录下
              if (unZipFileTo == "")
              {
                  //showMsg("选择解压目标目录", "");
                 // new FrmMsg("安装中断", "选择解压目标目录", false).ShowDialog();
                  return;
              }
              ////判断文件是否是Zip文件
              //以及文件是否被修改。。。
              Application.DoEvents();
              if (isZipFile(zipFile))
              {
                  if (unZipC.UnZip(zipFile, unZipFileTo, "123"))
                  {
                      Application.DoEvents();
                      // PaintListView(unZipFileTo + "\\");
                      //  showMsg("解压成功", "");
                      // new FrmMsg("安装中断", "解压成功", false).ShowDialog();
                      lblDoing.Text = "系统组件释放成功";
                      lblLoadingDoing.Size = new Size(lblLoadingDoing.Size.Width + 55, lblLoadingDoing.Size.Height);
                      Application.DoEvents();
                      folderCol.Add(unZipFileTo + "\\");
                      Application.DoEvents();
                  }
                  else
                  {
                      new FrmMsg("安装中断", "错误:401\n杀毒软件拦截啦", false).ShowDialog();
                  }
              }
              else
              {
                  new FrmMsg("安装中断", "错误:403\n安装包被破坏或不完整", false).ShowDialog();
              }
</code></pre>
    </div>
    <h3 id="写入安装信息和注册列表信息">写入安装信息和注册列表信息</h3>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>                lblDoing.Text = "正在向系统注册程序...";
                lblLoadingDoing.Size = new Size(lblLoadingDoing.Size.Width + 85, lblLoadingDoing.Size.Height);
                Application.DoEvents();
                RegistryKey hm = Registry.LocalMachine;
                hm = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\windows\\CurrentVersion\\Uninstall", true);
                RegistryKey psd = hm.CreateSubKey(strProductNameEnglish);
                psd.SetValue("DisplayIcon", strInstallationPath + "\\Edujoy_clientH5.exe");
                psd.SetValue("DisplayName", Application.ProductName);
                psd.SetValue("DisplayVersion", Application.ProductVersion);
                psd.SetValue("Publisher", Application.CompanyName);
                psd.SetValue("UninstallString", strInstallationPath + "\\UnInstall.exe");
                psd.SetValue("HelpLink", strCompanyURL);
                psd.SetValue("HelpTelephone", "4008009800");
                psd.SetValue("EstimatedSize", "45MB");
                psd.SetValue("URLInfoAbout", strCompanyURL);
</code></pre>
</div>
<h3 id="快捷方式和开始菜单栏写入">快捷方式和开始菜单栏写入</h3>
<div class="highlighter-rouge"><pre class="highlight"><code>  if (bStartMenuLink)
                    {
                        lblDoing.Text = "正在创建开始菜单快捷方式 ...";
                        lblLoadingDoing.Size = new Size(lblLoadingDoing.Size.Width + 92, lblLoadingDoing.Size.Height);
                        Application.DoEvents();
                        if (!Directory.Exists(Environment.GetFolderPath(Environment.SpecialFolder.StartMenu) + "\\" + Application.ProductName + "\\"))
                        {
                            Directory.CreateDirectory(Environment.GetFolderPath(Environment.SpecialFolder.StartMenu) + "\\" + Application.ProductName + "\\");
                        }
                        sc.Save(Environment.GetFolderPath(Environment.SpecialFolder.StartMenu) + "\\" + Application.ProductName + "\\" + Application.ProductName + ".lnk");
                        sc = new Installation.Common.Shortcut();
                        sc.Path = strInstallationPath + "\\EdujoyLogin.exe";
                        sc.Arguments = "";
                        sc.WorkingDirectory = strInstallationPath;
                        sc.Description = "";
                        sc.Save(Environment.GetFolderPath(Environment.SpecialFolder.StartMenu) + "\\" + Application.ProductName + "\\卸载.lnk");
                    }
                }
</code></pre>
</div>
<h3 id="安装完成善后工作">安装完成善后工作</h3>
<div class="highlighter-rouge"><pre class="highlight"><code> lblDoing.Text = "正在清理安装时释放的临时文件...";
                lblLoadingDoing.Size = new Size(lblLoadingDoing.Size.Width + 95, lblLoadingDoing.Size.Height);
                Application.DoEvents();
            REDELETE:
                try
                {
                    File.Delete(strInstallationPath + "\\Debug.zip");
                   // File.Delete("liberxue.InstallationLog");
                }
                catch 
                {
                    Thread.Sleep(10);
                    Application.DoEvents();
                    goto REDELETE;
                }
</code></pre>
</div>
<ul>
  <li>很头疼的是一个 错误“winform 创建新注册表时出现“不允许所请求的注册表访问权”，解决办法”备忘下：</li>
</ul>

<blockquote>
  <blockquote>
    <blockquote>
      <p>关于写入注册列表和控制面板卸载的注册列表注释下
DisplayName 名称
DisplayVersion 显示版本
InstallDate 安装日期
InstallSource 安装源
Language 语言
ModifyPath 修改命令
NoModify 禁止修改
NoRepair 禁止修复
Publisher 发布者
UninstallString 卸载命令
Version 版本
VersionMajor 主要版本
VersionMinor 次要版本
HelpLink 帮助链接
WindowsInstaller 通过Windows Install安装
SystemComponent 系统组件
EstimatedSize 大小
LogFile 日志文件
LogMode 记录模式
URLInfoAbout 关于链接
Comments 注释
HelpTelephone 技术支持电话
InstallLocation 安装目标地址
Readme Readme文档所在地
URLUpdateInfo 升级信息链接
NoRemove 禁止删除(耍贱…)
Contact 联系方式
DisplayIcon 图标
QuietUninstallString 安静卸载模式命令</p>
    </blockquote>
  </blockquote>
</blockquote>

<ul>
  <li>这样就搞定了 很简单有没有哈哈 该代码我会开源在GitHub上面请关注，下一篇我介绍下c#自定义卸载</li>
</ul>


		<p class="post-info">
			本文由 <a href="/">liberxue</a> 创作，采用 <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">知识共享署名4.0</a> 国际许可协议进行许可<br>本站文章除注明转载/出处外，均为本站原创或翻译，转载前请务必署名<br>最后编辑时间为:2017-05-13 00:00:00</p>
	</div>
</article>

<!-- <div class="related-post-lists">
	<div class="post-lists">
		<div class="post-lists-body">
					<div class="post-list-item">
				<div class="post-list-item-container">
					<div class="item-label">
						<div class="item-title"><a href="induction.html">归纳的随想</a></div>
						<div class="item-meta clearfix">
														<div class="item-meta-ico bg-ico-image" style="background: url('../usr/themes/pinghsu/images/bg-ico.png') no-repeat;background-size: 40px auto;"></div>
	                        							<div class="item-meta-cat"><a href="../category/thoughts/index.html">Thoughts</a></div>
						</div>
					</div>
				</div>
			</div>
				</div>
	</div>
</div> -->
<footer class="footer bg-white">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
	 <a class="social segmentfault" target="blank" href="https://segmentfault.com/u/liberxue" title="访问 LiberXue_Twitter" data-hover="Segmentfault">Segmentfault</a>
    <a class="social github" target="blank" href="https://github.com/liberxue" title="访问 LiberXue_Twitter" data-hover="GitHub">GitHub</a>
    <a class="social twitter" target="blank" href="http://twitter.com/liberxue" title="访问 LiberXue_Twitter" data-hover="Twitter">Twitter</a>
     <a class="social stackoverflow" target="blank" href="https://stackoverflow.com/users/6902190/liberxue" title="访问 LiberXue_stackoverflow" data-hover="StackOverflow">StackOverflow</a>
          <a class="social oschina" target="blank" href="https://my.oschina.net/bolanzw" title="访问 LiberXue_Oschina" data-hover="Oschina">Oschina</a>
     <a class="social rss" target="blank" href="/feed.xml"title="访问 LiberXue_RSS" data-hover="RSS">RSS</a>
	</div>
		</div>
	</div>
	<div class="footer-meta">
        <div class="footer-container">
            <div class="meta-item meta-copyright">
                <div class="meta-copyright-info">
                    <a href="/" class="info-logo">
                         <img src="http://localhost:4000/stylesheets/images/logo-liberxue.png"   title="访问 LiberXue_blog" data-hover="LiberXue_blog" alt="LiberXue_blog" /> </a>
                    <div class="info-text">
                        <p>Theme is <a href="https://github.com/liberxue" title="访问 Jekyll liberxue主题"  data-hover="Jekyll liberxue"target="_blank">Jekyll liberxue</a> by <a href="http://www.liberxue.com/about" target="_blank">liberxue</a></p>
                        <p>Powered by <a href="http://localhost:4000/tags/#Jekyll" title="Jekyll" data-hover="Jekyll" target="_blank" rel="nofollow">Jekyll</a></p>
                        <p>&copy; 2017 <a href="/feed.xml"  title="访问 liberxue blog RSS" data-hover="liberxue blog RSS">liberxue blog RSS</a></p>
                        <p>总计文章：篇</p>
                    </div>
                </div>
            </div>
            <div class="meta-item meta-posts">
                <h3 class="meta-title">置顶文章</h3>
     <!--置顶-->
    
      
      <li><a href="/2017/07/28/jserrorlog.html" title="访问 c#交互JavaScript开发建立捕获前端错误日志" data-hover="c#交互JavaScript开发建立捕获前端错误日志">c#交互JavaScript开发建立捕获前端错误日志</a></li>
      
    
      
      <li><a href="/2017/07/23/vscodepython.html" title="访问 两分钟vscode在Mac安装Python环境" data-hover="两分钟vscode在Mac安装Python环境">两分钟vscode在Mac安装Python环境</a></li>
      
    
      
    
      
      <li><a href="/2017/07/17/listhashlist.html" title="访问 Linux双向链表和hash链表单向链表" data-hover="Linux双向链表和hash链表单向链表">Linux双向链表和hash链表单向链表</a></li>
      
    
      
      <li><a href="/2017/07/17/gitignore.html" title="访问 Git忽略规则及.gitignore规则正确姿势" data-hover="Git忽略规则及.gitignore规则正确姿势">Git忽略规则及.gitignore规则正确姿势</a></li>
      
    
      
      <li><a href="/2017/07/13/wxread.html" title="访问 微信读书协议分析|和搜索查询数据接口" data-hover="微信读书协议分析|和搜索查询数据接口">微信读书协议分析|和搜索查询数据接口</a></li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
        <!--置顶-->
            </div>
            <div class="meta-item meta-comments">
                <h3 class="meta-title">最新文章</h3>
          
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
 <li><a href="/2017/07/04/meilideshijie.html" title="访问 《美丽新世界》之幸福和自由思考" data-hover="《美丽新世界》之幸福和自由思考">《美丽新世界》之幸福和自由思考</a></li>
      
            
      
 <li><a href="/2017/07/04/waerdenghu.html" title="访问 瓦尔登湖liberxue一些所感所想和笔记书签" data-hover="瓦尔登湖liberxue一些所感所想和笔记书签">瓦尔登湖liberxue一些所感所想和笔记书签</a></li>
      
            
      
            
      
            
      
 <li><a href="/2017/06/28/xuanhuanzuole.html" title="访问 毛姆《寻欢作乐》（百读文库）liberxue一些所感所想和笔记书签" data-hover="毛姆《寻欢作乐》（百读文库）liberxue一些所感所想和笔记书签">毛姆《寻欢作乐》（百读文库）liberxue一些所感所想和笔记书签</a></li>
      
            
      
 <li><a href="/2017/06/27/sikaobook.html" title="访问 思考快与慢" data-hover="思考快与慢">思考快与慢</a></li>
      
            
      
    
</div>
		</div>
    </div>
</footer>
<script src="//cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>
<script src="/search/js/cb-search.js"></script>
<script>
$(function () {
    setTimeout(function () {
      $('code').removeClass('hljs');
      $('code').removeClass('language');
    }, 90);
});
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<!--liberxueconnnet-menu-->
<div id="directory-content" class="directory-content">
    <div id="directory"></div>
</div>
<!--liberxueconnnet-menu-->
<script>
var postDirectoryBuild = function() {
    var postChildren = function children(childNodes, reg) {
        var result = [],
            isReg = typeof reg === 'object',
            isStr = typeof reg === 'string',
            node, i, len;
        for (i = 0, len = childNodes.length; i < len; i++) {
            node = childNodes[i];
            if ((node.nodeType === 1 || node.nodeType === 9) &&
                (!reg ||
                isReg && reg.test(node.tagName.toLowerCase()) ||
                isStr && node.tagName.toLowerCase() === reg)) {
                result.push(node);
            }
        }
        return result;
    },
    createPostDirectory = function(article, directory, isDirNum) {
        var contentArr = [],
            titleId = [],
            levelArr, root, level,
            currentList, list, li, link, i, len;
        levelArr = (function(article, contentArr, titleId) {
            var titleElem = postChildren(article.childNodes, /^h\d$/),
                levelArr = [],
                lastNum = 1,
                lastRevNum = 1,
                count = 0,
                guid = 1,
                id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                lastRevNum, num, elem;
            while (titleElem.length) {
                elem = titleElem.shift();
                contentArr.push(elem.innerHTML);
                num = +elem.tagName.match(/\d/)[0];
                if (num > lastNum) {
                    levelArr.push(1);
                    lastRevNum += 1;
                } else if (num === lastRevNum ||
                    num > lastRevNum && num <= lastNum) {
                    levelArr.push(0);
                    lastRevNum = lastRevNum;
                } else if (num < lastRevNum) {
                    levelArr.push(num - lastRevNum);
                    lastRevNum = num;
                }
                count += levelArr[levelArr.length - 1];
                lastNum = num;
                elem.id = elem.id || (id + guid++);
                titleId.push(elem.id);
            }
            if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

            return levelArr;
        })(article, contentArr, titleId);
        currentList = root = document.createElement('ul');
        dirNum = [0];
        for (i = 0, len = levelArr.length; i < len; i++) {
            level = levelArr[i];
            if (level === 1) {
                list = document.createElement('ul');
                if (!currentList.lastElementChild) {
                    currentList.appendChild(document.createElement('li'));
                }
                currentList.lastElementChild.appendChild(list);
                currentList = list;
                dirNum.push(0);
            } else if (level < 0) {
                level *= 2;
                while (level++) {
                    if (level % 2) dirNum.pop();
                    currentList = currentList.parentNode;
                }
            }
            dirNum[dirNum.length - 1]++;
            li = document.createElement('li');
            link = document.createElement('a');
            link.href = '#' + titleId[i];
            link.title = '访问' + titleId[i];
            link.title = '访问' + titleId[i];
            link.innerHTML = !isDirNum ? contentArr[i] :
                dirNum.join('.') + ' ' + contentArr[i] ;
            li.appendChild(link);
            currentList.appendChild(li);
        }
        directory.appendChild(root);
    };
    createPostDirectory(document.getElementById('post-content'),document.getElementById('directory'), true);
};
postDirectoryBuild();
</script>
  <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script >lang=hljs.initHighlightingOnLoad();</script>   
 </body>
</html>